<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đổi mật khẩu - E-Shop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/assets/css/user.css">
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Profile Header -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between">
            <div>
                <h1 class="text-2xl font-bold text-gray-800">Đổi mật khẩu</h1>
                <p class="text-gray-600 mt-1">Để bảo mật tài khoản, vui lòng không chia sẻ mật khẩu với người khác</p>
            </div>
            <div class="mt-4 md:mt-0 flex items-center">
                <div class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">
                    <i class="fas fa-shield-alt mr-1"></i> Bảo mật
                </div>
            </div>
        </div>
    </div>
    
    
            
    <!-- Password Form -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <form id="password-form">
            <!-- Current Password -->
            <div class="mb-6">
                <label for="current-password" class="block text-gray-700 font-medium mb-2">Mật khẩu hiện tại</label>
                <div class="password-container">
                    <input 
                        type="password" 
                        id="current-password" 
                        name="current-password" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                        placeholder="Nhập mật khẩu hiện tại"
                        required
                    >
                    <span class="toggle-password" data-target="current-password">
                        <i class="far fa-eye"></i>
                    </span>
                </div>
            </div>
            
            <!-- New Password -->
            <div class="mb-6">
                <label for="new-password" class="block text-gray-700 font-medium mb-2">Mật khẩu mới</label>
                <div class="password-container">
                    <input 
                        type="password" 
                        id="new-password" 
                        name="new-password" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                        placeholder="Nhập mật khẩu mới"
                        required
                    >
                    <span class="toggle-password" data-target="new-password">
                        <i class="far fa-eye"></i>
                    </span>
                </div>
                
                <!-- Password Strength Meter -->
                <div class="mt-3">
                    <div class="password-strength-meter mb-2">
                        <div class="strength-bar" id="password-strength-bar" style="width: 0%; background-color: #e2e8f0;"></div>
                    </div>
                    <div class="text-sm text-gray-600" id="password-strength-text">Độ mạnh: <span class="font-medium">Rất yếu</span></div>
                </div>
                
                <!-- Password Requirements -->
                <div class="mt-4">
                    <p class="text-gray-700 font-medium mb-2">Mật khẩu mới phải:</p>
                    <ul class="text-sm text-gray-600 space-y-1">
                        <li class="requirement-item" id="length-req">
                            <i class="fas fa-circle text-gray-300 mr-2 text-xs"></i> 
                            Chứa ít nhất <span class="font-medium">8 ký tự</span>
                        </li>
                        <li class="requirement-item" id="uppercase-req">
                            <i class="fas fa-circle text-gray-300 mr-2 text-xs"></i> 
                            Chứa ít nhất <span class="font-medium">1 chữ hoa</span> (A-Z)
                        </li>
                        <li class="requirement-item" id="lowercase-req">
                            <i class="fas fa-circle text-gray-300 mr-2 text-xs"></i> 
                            Chứa ít nhất <span class="font-medium">1 chữ thường</span> (a-z)
                        </li>
                        <li class="requirement-item" id="number-req">
                            <i class="fas fa-circle text-gray-300 mr-2 text-xs"></i> 
                            Chứa ít nhất <span class="font-medium">1 số</span> (0-9)
                        </li>
                        <li class="requirement-item" id="special-req">
                            <i class="fas fa-circle text-gray-300 mr-2 text-xs"></i> 
                            Chứa ít nhất <span class="font-medium">1 ký tự đặc biệt</span> (!@#$%^&*)
                        </li>
                    </ul>
                </div>
            </div>
            
            <!-- Confirm New Password -->
            <div class="mb-6">
                <label for="confirm-password" class="block text-gray-700 font-medium mb-2">Xác nhận mật khẩu mới</label>
                <div class="password-container">
                    <input 
                        type="password" 
                        id="confirm-password" 
                        name="confirm-password" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                        placeholder="Nhập lại mật khẩu mới"
                        required
                    >
                    <span class="toggle-password" data-target="confirm-password">
                        <i class="far fa-eye"></i>
                    </span>
                </div>
                <div id="password-match" class="mt-2 text-sm text-red-600 hidden">
                    <i class="fas fa-exclamation-circle mr-1"></i> Mật khẩu không khớp
                </div>
            </div>
            
            <!-- Form Actions -->
            <div class="flex flex-col sm:flex-row gap-3">
                <button 
                    type="submit" 
                    id="submit-btn"
                    class="px-6 py-3 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2"
                >
                    <i class="fas fa-key mr-2"></i> Đổi mật khẩu
                </button>
                <button 
                    type="button" 
                    class="px-6 py-3 bg-gray-100 text-gray-800 font-medium rounded-lg hover:bg-gray-200 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2"
                    onclick="history.back()"
                >
                    <i class="fas fa-times mr-2"></i> Hủy bỏ
                </button>
            </div>
        </form>
    </div>
    <!-- Success Alert (Hidden by default) -->
    <div id="success-alert" class="success-alert bg-green-50 border-l-4 border-green-500 p-4 mb-6 rounded">
        <div class="flex items-start">
            <div class="flex-shrink-0">
                <i class="fas fa-check-circle text-green-500 text-xl"></i>
            </div>
            <div class="ml-3">
                <h3 class="text-green-800 font-medium">Đổi mật khẩu thành công!</h3>
                <div class="mt-2 text-green-700">
                    <p>Mật khẩu của bạn đã được cập nhật thành công.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
            // Hàm gửi chiều cao về trang chủ
        function sendHeightToParent() {
            const height = Math.max(
                document.body.scrollHeight,
                document.body.offsetHeight,
                document.documentElement.scrollHeight,
                document.documentElement.offsetHeight
            );
            
            // Gửi chiều cao về trang chủ
            window.parent.postMessage({
                type: 'resize',
                height: height
            }, '*');
        }

        // Sử dụng requestAnimationFrame để giới hạn tần suất gửi
        let lastSentHeight = 0;
        function throttledSendHeight() {
            const currentHeight = Math.max(
                document.body.scrollHeight,
                document.documentElement.scrollHeight
            );
            
            // Chỉ gửi nếu chiều cao thay đổi đáng kể
            if (Math.abs(currentHeight - lastSentHeight) > 50) {
                sendHeightToParent();
                lastSentHeight = currentHeight;
            }
            requestAnimationFrame(throttledSendHeight);
        }

        // Bắt đầu theo dõi
        throttledSendHeight();

        // Gửi chiều cao khi trang tải xong
        window.addEventListener('load', () => {
            setTimeout(sendHeightToParent, 300);
        });

        // Trả lời khi nhận được yêu cầu từ trang chủ
        window.addEventListener('message', (event) => {
            if (event.data === 'getHeight') {
                throttledSendHeight();
            }
        });

        // Theo dõi thay đổi nội dung với MutationObserver
        const observer = new MutationObserver(() => {
            throttledSendHeight();
        });

        observer.observe(document.body, {
            childList: true,
            subtree: true,
            attributes: false,
            characterData: false
        });
  
        // DOM Elements
        const passwordForm = document.getElementById('password-form');
        const currentPassword = document.getElementById('current-password');
        const newPassword = document.getElementById('new-password');
        const confirmPassword = document.getElementById('confirm-password');
        const passwordStrengthBar = document.getElementById('password-strength-bar');
        const passwordStrengthText = document.getElementById('password-strength-text');
        const passwordMatch = document.getElementById('password-match');
        const loadingOverlay = document.getElementById('loading-overlay');
        const successAlert = document.getElementById('success-alert');
        const submitBtn = document.getElementById('submit-btn');
        
        // Password requirements elements
        const lengthReq = document.getElementById('length-req');
        const uppercaseReq = document.getElementById('uppercase-req');
        const lowercaseReq = document.getElementById('lowercase-req');
        const numberReq = document.getElementById('number-req');
        const specialReq = document.getElementById('special-req');
        
        // Toggle password visibility
        document.querySelectorAll('.toggle-password').forEach(toggle => {
            toggle.addEventListener('click', function() {
                const targetId = this.dataset.target;
                const targetInput = document.getElementById(targetId);
                const type = targetInput.getAttribute('type') === 'password' ? 'text' : 'password';
                targetInput.setAttribute('type', type);
                
                // Toggle eye icon
                this.querySelector('i').classList.toggle('fa-eye');
                this.querySelector('i').classList.toggle('fa-eye-slash');
            });
        });
        
        // Check password strength
        function checkPasswordStrength(password) {
            let strength = 0;
            const requirements = {
                length: password.length >= 8,
                uppercase: /[A-Z]/.test(password),
                lowercase: /[a-z]/.test(password),
                number: /[0-9]/.test(password),
                special: /[!@#$%^&*]/.test(password)
            };
            
            // Update requirement indicators
            lengthReq.classList.toggle('valid', requirements.length);
            uppercaseReq.classList.toggle('valid', requirements.uppercase);
            lowercaseReq.classList.toggle('valid', requirements.lowercase);
            numberReq.classList.toggle('valid', requirements.number);
            specialReq.classList.toggle('valid', requirements.special);
            
            // Calculate strength score
            if (requirements.length) strength += 20;
            if (requirements.uppercase) strength += 20;
            if (requirements.lowercase) strength += 20;
            if (requirements.number) strength += 20;
            if (requirements.special) strength += 20;
            
            // Update strength meter
            passwordStrengthBar.style.width = `${strength}%`;
            
            // Set strength text and color
            let strengthText, strengthColor;
            if (strength === 0) {
                strengthText = "Rất yếu";
                strengthColor = "#ef4444";
            } else if (strength <= 40) {
                strengthText = "Yếu";
                strengthColor = "#f97316";
            } else if (strength <= 60) {
                strengthText = "Trung bình";
                strengthColor = "#eab308";
            } else if (strength <= 80) {
                strengthText = "Mạnh";
                strengthColor = "#22c55e";
            } else {
                strengthText = "Rất mạnh";
                strengthColor = "#16a34a";
            }
            
            passwordStrengthBar.style.backgroundColor = strengthColor;
            passwordStrengthText.innerHTML = `Độ mạnh: <span class="font-medium" style="color: ${strengthColor}">${strengthText}</span>`;
            
            return strength >= 80; // Return true if strong enough
        }
        
        // Check if passwords match
        function checkPasswordMatch() {
            if (newPassword.value && confirmPassword.value) {
                if (newPassword.value !== confirmPassword.value) {
                    passwordMatch.classList.remove('hidden');
                    return false;
                } else {
                    passwordMatch.classList.add('hidden');
                    return true;
                }
            }
            return false;
        }
        
        // Show/hide loading overlay
        function showLoading() {
            loadingOverlay.classList.add('active');
        }
        
        function hideLoading() {
            loadingOverlay.classList.remove('active');
        }
        
        // Show success message
        function showSuccess() {
            successAlert.classList.add('active');
            setTimeout(() => {
                successAlert.classList.remove('active');
            }, 5000);
        }
        
        // Form submission
        passwordForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Validate form
            const isStrongPassword = checkPasswordStrength(newPassword.value);
            const passwordsMatch = checkPasswordMatch();
            
            if (!isStrongPassword) {
                alert('Mật khẩu mới chưa đủ mạnh. Vui lòng kiểm tra lại các yêu cầu.');
                return;
            }
            
            if (!passwordsMatch) {
                alert('Mật khẩu xác nhận không khớp.');
                return;
            }
            
            if (newPassword.value === currentPassword.value) {
                alert('Mật khẩu mới phải khác với mật khẩu hiện tại.');
                return;
            }
            
            // Show loading
            showLoading();
            
            // Simulate API call
            setTimeout(() => {
                hideLoading();
                showSuccess();
                
                // Reset form
                passwordForm.reset();
                
                // Reset password strength
                passwordStrengthBar.style.width = '0%';
                passwordStrengthText.innerHTML = 'Độ mạnh: <span class="font-medium">Rất yếu</span>';
                
                // Reset requirements
                document.querySelectorAll('.requirement-item').forEach(item => {
                    item.classList.remove('valid');
                });
                
                // Scroll to top to see success message
                window.scrollTo(0, 0);
            }, 1500);
        });
        
        // Event listeners for real-time validation
        newPassword.addEventListener('input', function() {
            checkPasswordStrength(this.value);
        });
        
        confirmPassword.addEventListener('input', function() {
            checkPasswordMatch();
        });
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Set focus to first input
            currentPassword.focus();
        });
    </script>
</body>
</html>